{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "e5caf5ee",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:53:07.118795Z",
     "iopub.status.busy": "2022-01-20T10:53:07.114000Z",
     "iopub.status.idle": "2022-01-20T10:53:27.541437Z",
     "shell.execute_reply": "2022-01-20T10:53:27.542055Z",
     "shell.execute_reply.started": "2022-01-11T11:33:21.979503Z"
    },
    "papermill": {
     "duration": 20.460395,
     "end_time": "2022-01-20T10:53:27.542438",
     "exception": false,
     "start_time": "2022-01-20T10:53:07.082043",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "/kaggle/input/mlub2021-session8/train.txt\n",
      "/kaggle/input/mlub2021-session8/test/test/test/test_composite000000426.png\n",
      "/kaggle/input/mlub2021-session8/train/train/train/train_composite000012068.png\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import pandas as pd \n",
    "\n",
    "import os\n",
    "for dirname, _, filenames in os.walk('/kaggle/input'):\n",
    "    for filename in filenames:\n",
    "        print(os.path.join(dirname, filename))\n",
    "        break"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "4c079f7b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:53:27.582515Z",
     "iopub.status.busy": "2022-01-20T10:53:27.581965Z",
     "iopub.status.idle": "2022-01-20T10:53:33.683974Z",
     "shell.execute_reply": "2022-01-20T10:53:33.683487Z",
     "shell.execute_reply.started": "2022-01-11T11:33:22.039887Z"
    },
    "papermill": {
     "duration": 6.123225,
     "end_time": "2022-01-20T10:53:33.684101",
     "exception": false,
     "start_time": "2022-01-20T10:53:27.560876",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# others imports\n",
    "\n",
    "import imageio\n",
    "from skimage import transform,io\n",
    "import matplotlib.pyplot as plt\n",
    "\n",
    "from sklearn.model_selection import train_test_split\n",
    "from sklearn.metrics import mean_squared_error\n",
    "\n",
    "import tensorflow as tf\n",
    "from tensorflow import keras\n",
    "from tensorflow.keras.callbacks import EarlyStopping, ModelCheckpoint\n",
    "from keras.layers import BatchNormalization\n",
    "from keras.layers import Dropout, Flatten, Conv2D, MaxPool2D, Dense\n",
    "\n",
    "from keras.layers import Dropout, Flatten, Conv2D, MaxPool2D, Dense\n",
    "from tensorflow.keras.preprocessing.image import ImageDataGenerator\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "752a4b19",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:53:33.719968Z",
     "iopub.status.busy": "2022-01-20T10:53:33.719391Z",
     "iopub.status.idle": "2022-01-20T10:53:33.742572Z",
     "shell.execute_reply": "2022-01-20T10:53:33.741861Z",
     "shell.execute_reply.started": "2022-01-11T11:33:22.053424Z"
    },
    "papermill": {
     "duration": 0.042467,
     "end_time": "2022-01-20T10:53:33.742679",
     "exception": false,
     "start_time": "2022-01-20T10:53:33.700212",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "np.random.seed(42)\n",
    "tf.random.set_seed(42)\n",
    "keras.backend.clear_session()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "02ef9779",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:53:33.777989Z",
     "iopub.status.busy": "2022-01-20T10:53:33.777387Z",
     "iopub.status.idle": "2022-01-20T10:53:33.811987Z",
     "shell.execute_reply": "2022-01-20T10:53:33.812578Z",
     "shell.execute_reply.started": "2022-01-11T11:33:22.067408Z"
    },
    "papermill": {
     "duration": 0.054402,
     "end_time": "2022-01-20T10:53:33.812742",
     "exception": false,
     "start_time": "2022-01-20T10:53:33.758340",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(15000, 2)\n"
     ]
    }
   ],
   "source": [
    "df_train = pd.read_csv('../input/mlub2021-session8/train.txt',sep=' ',header=None)\n",
    "print(df_train.shape)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "63d5b013",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:53:33.849956Z",
     "iopub.status.busy": "2022-01-20T10:53:33.848566Z",
     "iopub.status.idle": "2022-01-20T10:53:33.850647Z",
     "shell.execute_reply": "2022-01-20T10:53:33.851031Z",
     "shell.execute_reply.started": "2022-01-11T11:33:22.095266Z"
    },
    "papermill": {
     "duration": 0.021734,
     "end_time": "2022-01-20T10:53:33.851171",
     "exception": false,
     "start_time": "2022-01-20T10:53:33.829437",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# take only the first 3000 images\n",
    "#df_train = df_train.head(3000)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "74df12ab",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:53:33.889560Z",
     "iopub.status.busy": "2022-01-20T10:53:33.888815Z",
     "iopub.status.idle": "2022-01-20T10:53:33.904059Z",
     "shell.execute_reply": "2022-01-20T10:53:33.904514Z",
     "shell.execute_reply.started": "2022-01-11T11:33:22.103195Z"
    },
    "papermill": {
     "duration": 0.037609,
     "end_time": "2022-01-20T10:53:33.904662",
     "exception": false,
     "start_time": "2022-01-20T10:53:33.867053",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "      <th>1</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>/train/train_composite000000000.png</td>\n",
       "      <td>20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>/train/train_composite000000001.png</td>\n",
       "      <td>18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>/train/train_composite000000002.png</td>\n",
       "      <td>7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>/train/train_composite000000003.png</td>\n",
       "      <td>18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>/train/train_composite000000004.png</td>\n",
       "      <td>17</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14995</th>\n",
       "      <td>/train/train_composite000014995.png</td>\n",
       "      <td>22</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14996</th>\n",
       "      <td>/train/train_composite000014996.png</td>\n",
       "      <td>7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14997</th>\n",
       "      <td>/train/train_composite000014997.png</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14998</th>\n",
       "      <td>/train/train_composite000014998.png</td>\n",
       "      <td>29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14999</th>\n",
       "      <td>/train/train_composite000014999.png</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>15000 rows Ã— 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                         0   1\n",
       "0      /train/train_composite000000000.png  20\n",
       "1      /train/train_composite000000001.png  18\n",
       "2      /train/train_composite000000002.png   7\n",
       "3      /train/train_composite000000003.png  18\n",
       "4      /train/train_composite000000004.png  17\n",
       "...                                    ...  ..\n",
       "14995  /train/train_composite000014995.png  22\n",
       "14996  /train/train_composite000014996.png   7\n",
       "14997  /train/train_composite000014997.png   2\n",
       "14998  /train/train_composite000014998.png  29\n",
       "14999  /train/train_composite000014999.png   0\n",
       "\n",
       "[15000 rows x 2 columns]"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_train"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "197ea28a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:53:33.941957Z",
     "iopub.status.busy": "2022-01-20T10:53:33.941154Z",
     "iopub.status.idle": "2022-01-20T10:53:33.958244Z",
     "shell.execute_reply": "2022-01-20T10:53:33.958706Z",
     "shell.execute_reply.started": "2022-01-11T11:33:22.123907Z"
    },
    "papermill": {
     "duration": 0.037424,
     "end_time": "2022-01-20T10:53:33.958858",
     "exception": false,
     "start_time": "2022-01-20T10:53:33.921434",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>1</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>count</th>\n",
       "      <td>15000.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mean</th>\n",
       "      <td>14.377067</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>std</th>\n",
       "      <td>8.655134</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>min</th>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25%</th>\n",
       "      <td>7.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50%</th>\n",
       "      <td>14.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75%</th>\n",
       "      <td>22.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>max</th>\n",
       "      <td>29.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  1\n",
       "count  15000.000000\n",
       "mean      14.377067\n",
       "std        8.655134\n",
       "min        0.000000\n",
       "25%        7.000000\n",
       "50%       14.000000\n",
       "75%       22.000000\n",
       "max       29.000000"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_train.describe()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "daa9ce81",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:53:33.998580Z",
     "iopub.status.busy": "2022-01-20T10:53:33.997708Z",
     "iopub.status.idle": "2022-01-20T10:53:34.000165Z",
     "shell.execute_reply": "2022-01-20T10:53:33.999707Z",
     "shell.execute_reply.started": "2022-01-11T11:33:22.146159Z"
    },
    "papermill": {
     "duration": 0.02389,
     "end_time": "2022-01-20T10:53:34.000280",
     "exception": false,
     "start_time": "2022-01-20T10:53:33.976390",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "data_dir = '../input/mlub2021-session8/train/train/'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "ec400165",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:53:34.043129Z",
     "iopub.status.busy": "2022-01-20T10:53:34.042240Z",
     "iopub.status.idle": "2022-01-20T10:56:43.601992Z",
     "shell.execute_reply": "2022-01-20T10:56:43.602434Z",
     "shell.execute_reply.started": "2022-01-11T11:33:22.154359Z"
    },
    "papermill": {
     "duration": 189.584675,
     "end_time": "2022-01-20T10:56:43.602590",
     "exception": false,
     "start_time": "2022-01-20T10:53:34.017915",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# read images and store into a np array\n",
    "\n",
    "im_size = 64\n",
    "N = df_train.shape[0]\n",
    "X = np.zeros((N, im_size,im_size))\n",
    "y = np.zeros((N))\n",
    "cont = 0\n",
    "\n",
    "for ind, item in df_train.iterrows():\n",
    "    im       = imageio.imread(data_dir + item[0])/255. \n",
    "    small_im = transform.resize(im, (im_size,im_size), mode='symmetric', preserve_range=True)\n",
    "    X[cont, :,:] = small_im\n",
    "    y[cont] = item[1]\n",
    "    cont += 1\n",
    "    \n",
    "plt.imshow(small_im,cmap='gray')\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f599a654",
   "metadata": {
    "papermill": {
     "duration": 0.0295,
     "end_time": "2022-01-20T10:56:43.650883",
     "exception": false,
     "start_time": "2022-01-20T10:56:43.621383",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "For generating more images I used the lib:\n",
    "https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/image/ImageDataGenerator"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "8cf5964a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:56:43.716244Z",
     "iopub.status.busy": "2022-01-20T10:56:43.715375Z",
     "iopub.status.idle": "2022-01-20T10:56:43.718879Z",
     "shell.execute_reply": "2022-01-20T10:56:43.719426Z",
     "shell.execute_reply.started": "2022-01-11T11:35:00.285694Z"
    },
    "papermill": {
     "duration": 0.040336,
     "end_time": "2022-01-20T10:56:43.719604",
     "exception": false,
     "start_time": "2022-01-20T10:56:43.679268",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "data_generator = ImageDataGenerator(\n",
    "    rotation_range = 15,\n",
    "    width_shift_range = 0.1,\n",
    "    height_shift_range = 0.1,\n",
    "    horizontal_flip = True,\n",
    "    vertical_flip = True,\n",
    "    fill_mode = \"nearest\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "77c6f41d",
   "metadata": {
    "papermill": {
     "duration": 0.026247,
     "end_time": "2022-01-20T10:56:43.773852",
     "exception": false,
     "start_time": "2022-01-20T10:56:43.747605",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "Generate train and test"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "ef489773",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:56:43.840072Z",
     "iopub.status.busy": "2022-01-20T10:56:43.839312Z",
     "iopub.status.idle": "2022-01-20T10:56:44.011311Z",
     "shell.execute_reply": "2022-01-20T10:56:44.011937Z",
     "shell.execute_reply.started": "2022-01-11T11:35:00.294322Z"
    },
    "papermill": {
     "duration": 0.210011,
     "end_time": "2022-01-20T10:56:44.012178",
     "exception": false,
     "start_time": "2022-01-20T10:56:43.802167",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "X_train, X_val, y_train, y_val= train_test_split(X, y, test_size=0.3, random_state=66)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "2ffb7c3a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:56:44.079027Z",
     "iopub.status.busy": "2022-01-20T10:56:44.078259Z",
     "iopub.status.idle": "2022-01-20T10:56:44.081930Z",
     "shell.execute_reply": "2022-01-20T10:56:44.082522Z",
     "shell.execute_reply.started": "2022-01-11T11:35:00.508519Z"
    },
    "papermill": {
     "duration": 0.039218,
     "end_time": "2022-01-20T10:56:44.082693",
     "exception": false,
     "start_time": "2022-01-20T10:56:44.043475",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# add 1 at the end to match input_shape of the model\n",
    "X_train = X_train.reshape(X_train.shape + (1,))\n",
    "X_val = X_val.reshape(X_val.shape + (1,))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dff21f46",
   "metadata": {
    "papermill": {
     "duration": 0.023975,
     "end_time": "2022-01-20T10:56:44.134613",
     "exception": false,
     "start_time": "2022-01-20T10:56:44.110638",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "Generate the network model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "ec2056e3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:56:44.209737Z",
     "iopub.status.busy": "2022-01-20T10:56:44.208888Z",
     "iopub.status.idle": "2022-01-20T10:56:46.583405Z",
     "shell.execute_reply": "2022-01-20T10:56:46.583852Z",
     "shell.execute_reply.started": "2022-01-11T11:35:00.521446Z"
    },
    "papermill": {
     "duration": 2.416781,
     "end_time": "2022-01-20T10:56:46.584020",
     "exception": false,
     "start_time": "2022-01-20T10:56:44.167239",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-01-20 10:56:44.284177: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n",
      "2022-01-20 10:56:44.398209: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n",
      "2022-01-20 10:56:44.399206: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n",
      "2022-01-20 10:56:44.401371: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "2022-01-20 10:56:44.402288: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n",
      "2022-01-20 10:56:44.403297: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n",
      "2022-01-20 10:56:44.404388: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n",
      "2022-01-20 10:56:46.186021: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n",
      "2022-01-20 10:56:46.186856: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n",
      "2022-01-20 10:56:46.187512: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\n",
      "2022-01-20 10:56:46.188081: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 15403 MB memory:  -> device: 0, name: Tesla P100-PCIE-16GB, pci bus id: 0000:00:04.0, compute capability: 6.0\n"
     ]
    }
   ],
   "source": [
    "# best model i tried\n",
    "model = keras.models.Sequential()\n",
    "model.add(Conv2D(filters=32, kernel_size=5, padding=\"same\", activation=\"relu\", input_shape=[64, 64, 1]))\n",
    "model.add(MaxPool2D(pool_size=2, strides=2, padding='valid'))\n",
    "\n",
    "model.add(Conv2D(filters=64, kernel_size=3, padding=\"same\", activation=\"relu\"))\n",
    "model.add(MaxPool2D(pool_size=2, strides=2, padding='valid'))\n",
    "\n",
    "model.add(Conv2D(filters=128, kernel_size=3, padding=\"same\", activation=\"relu\"))\n",
    "model.add(MaxPool2D(pool_size=2, strides=2, padding='valid'))\n",
    "\n",
    "model.add(Flatten())\n",
    "model.add(Dense(256, activation=\"relu\"))\n",
    "model.add(Dense(64, activation=\"relu\"))\n",
    "model.add(Dense(32, activation=\"relu\"))\n",
    "model.add(Dense(1, activation=\"linear\"))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "5838e643",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:56:46.636255Z",
     "iopub.status.busy": "2022-01-20T10:56:46.634614Z",
     "iopub.status.idle": "2022-01-20T10:56:46.643608Z",
     "shell.execute_reply": "2022-01-20T10:56:46.643050Z",
     "shell.execute_reply.started": "2022-01-11T12:02:47.318589Z"
    },
    "papermill": {
     "duration": 0.041209,
     "end_time": "2022-01-20T10:56:46.643739",
     "exception": false,
     "start_time": "2022-01-20T10:56:46.602530",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Model: \"sequential\"\n",
      "_________________________________________________________________\n",
      "Layer (type)                 Output Shape              Param #   \n",
      "=================================================================\n",
      "conv2d (Conv2D)              (None, 64, 64, 32)        832       \n",
      "_________________________________________________________________\n",
      "max_pooling2d (MaxPooling2D) (None, 32, 32, 32)        0         \n",
      "_________________________________________________________________\n",
      "conv2d_1 (Conv2D)            (None, 32, 32, 64)        18496     \n",
      "_________________________________________________________________\n",
      "max_pooling2d_1 (MaxPooling2 (None, 16, 16, 64)        0         \n",
      "_________________________________________________________________\n",
      "conv2d_2 (Conv2D)            (None, 16, 16, 128)       73856     \n",
      "_________________________________________________________________\n",
      "max_pooling2d_2 (MaxPooling2 (None, 8, 8, 128)         0         \n",
      "_________________________________________________________________\n",
      "flatten (Flatten)            (None, 8192)              0         \n",
      "_________________________________________________________________\n",
      "dense (Dense)                (None, 256)               2097408   \n",
      "_________________________________________________________________\n",
      "dense_1 (Dense)              (None, 64)                16448     \n",
      "_________________________________________________________________\n",
      "dense_2 (Dense)              (None, 32)                2080      \n",
      "_________________________________________________________________\n",
      "dense_3 (Dense)              (None, 1)                 33        \n",
      "=================================================================\n",
      "Total params: 2,209,153\n",
      "Trainable params: 2,209,153\n",
      "Non-trainable params: 0\n",
      "_________________________________________________________________\n"
     ]
    }
   ],
   "source": [
    "model.summary()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "dc52f3f7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:56:46.686253Z",
     "iopub.status.busy": "2022-01-20T10:56:46.685594Z",
     "iopub.status.idle": "2022-01-20T10:56:46.688245Z",
     "shell.execute_reply": "2022-01-20T10:56:46.688651Z",
     "shell.execute_reply.started": "2022-01-11T12:02:49.293789Z"
    },
    "papermill": {
     "duration": 0.026356,
     "end_time": "2022-01-20T10:56:46.688769",
     "exception": false,
     "start_time": "2022-01-20T10:56:46.662413",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<keras.layers.convolutional.Conv2D at 0x7f713d595c50>,\n",
       " <keras.layers.pooling.MaxPooling2D at 0x7f713d595ad0>,\n",
       " <keras.layers.convolutional.Conv2D at 0x7f713d81c150>,\n",
       " <keras.layers.pooling.MaxPooling2D at 0x7f713d7a7450>,\n",
       " <keras.layers.convolutional.Conv2D at 0x7f713d7a7650>,\n",
       " <keras.layers.pooling.MaxPooling2D at 0x7f713d731f50>,\n",
       " <keras.layers.core.Flatten at 0x7f713d736950>,\n",
       " <keras.layers.core.Dense at 0x7f713d743c50>,\n",
       " <keras.layers.core.Dense at 0x7f713d80a6d0>,\n",
       " <keras.layers.core.Dense at 0x7f713d7435d0>,\n",
       " <keras.layers.core.Dense at 0x7f713d736710>]"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "model.layers"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "a7cdd9f1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:56:46.732365Z",
     "iopub.status.busy": "2022-01-20T10:56:46.731610Z",
     "iopub.status.idle": "2022-01-20T10:56:46.743514Z",
     "shell.execute_reply": "2022-01-20T10:56:46.742980Z",
     "shell.execute_reply.started": "2022-01-11T12:02:51.432283Z"
    },
    "papermill": {
     "duration": 0.0359,
     "end_time": "2022-01-20T10:56:46.743635",
     "exception": false,
     "start_time": "2022-01-20T10:56:46.707735",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "model.compile(loss=\"mean_squared_error\", optimizer=\"Adam\",metrics=[\"mean_squared_error\",tf.keras.metrics.MeanAbsoluteError()])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "1e26ad7a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:56:46.785954Z",
     "iopub.status.busy": "2022-01-20T10:56:46.785192Z",
     "iopub.status.idle": "2022-01-20T10:56:46.787164Z",
     "shell.execute_reply": "2022-01-20T10:56:46.787574Z",
     "shell.execute_reply.started": "2022-01-11T12:02:52.947093Z"
    },
    "papermill": {
     "duration": 0.025306,
     "end_time": "2022-01-20T10:56:46.787695",
     "exception": false,
     "start_time": "2022-01-20T10:56:46.762389",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "early_stopping_cb = keras.callbacks.EarlyStopping(patience=10, restore_best_weights=True)\n",
    "check_pointer = ModelCheckpoint(filepath = \"my_keras_model.h5\", save_best_only=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "415024ad",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T10:56:46.833404Z",
     "iopub.status.busy": "2022-01-20T10:56:46.832216Z",
     "iopub.status.idle": "2022-01-20T11:05:06.236840Z",
     "shell.execute_reply": "2022-01-20T11:05:06.237255Z",
     "shell.execute_reply.started": "2022-01-11T12:02:54.526344Z"
    },
    "papermill": {
     "duration": 499.430532,
     "end_time": "2022-01-20T11:05:06.237418",
     "exception": false,
     "start_time": "2022-01-20T10:56:46.806886",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-01-20 10:56:46.996709: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the MLIR Optimization Passes are enabled (registered 2)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 1/200\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-01-20 10:56:48.248993: I tensorflow/stream_executor/cuda/cuda_dnn.cc:369] Loaded cuDNN version 8005\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "164/164 [==============================] - 12s 34ms/step - loss: 70.0484 - mean_squared_error: 70.0484 - mean_absolute_error: 6.9723 - val_loss: 29.9059 - val_mean_squared_error: 29.9059 - val_mean_absolute_error: 4.7222\n",
      "Epoch 2/200\n",
      "164/164 [==============================] - 6s 33ms/step - loss: 16.8169 - mean_squared_error: 16.8169 - mean_absolute_error: 3.1926 - val_loss: 28.4448 - val_mean_squared_error: 28.4448 - val_mean_absolute_error: 4.4106\n",
      "Epoch 3/200\n",
      "164/164 [==============================] - 6s 34ms/step - loss: 13.4102 - mean_squared_error: 13.4102 - mean_absolute_error: 2.8345 - val_loss: 14.0779 - val_mean_squared_error: 14.0779 - val_mean_absolute_error: 2.9011\n",
      "Epoch 4/200\n",
      "164/164 [==============================] - 5s 32ms/step - loss: 10.2733 - mean_squared_error: 10.2733 - mean_absolute_error: 2.4919 - val_loss: 9.8840 - val_mean_squared_error: 9.8840 - val_mean_absolute_error: 2.4156\n",
      "Epoch 5/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 9.5522 - mean_squared_error: 9.5522 - mean_absolute_error: 2.3818 - val_loss: 6.6858 - val_mean_squared_error: 6.6858 - val_mean_absolute_error: 2.0013\n",
      "Epoch 6/200\n",
      "164/164 [==============================] - 5s 32ms/step - loss: 8.4573 - mean_squared_error: 8.4573 - mean_absolute_error: 2.2584 - val_loss: 4.9664 - val_mean_squared_error: 4.9664 - val_mean_absolute_error: 1.6820\n",
      "Epoch 7/200\n",
      "164/164 [==============================] - 6s 34ms/step - loss: 8.1801 - mean_squared_error: 8.1801 - mean_absolute_error: 2.1965 - val_loss: 4.7242 - val_mean_squared_error: 4.7242 - val_mean_absolute_error: 1.6482\n",
      "Epoch 8/200\n",
      "164/164 [==============================] - 6s 36ms/step - loss: 6.6367 - mean_squared_error: 6.6367 - mean_absolute_error: 1.9898 - val_loss: 4.4045 - val_mean_squared_error: 4.4045 - val_mean_absolute_error: 1.5963\n",
      "Epoch 9/200\n",
      "164/164 [==============================] - 6s 34ms/step - loss: 6.1467 - mean_squared_error: 6.1467 - mean_absolute_error: 1.9055 - val_loss: 4.6769 - val_mean_squared_error: 4.6769 - val_mean_absolute_error: 1.6127\n",
      "Epoch 10/200\n",
      "164/164 [==============================] - 5s 31ms/step - loss: 5.9450 - mean_squared_error: 5.9450 - mean_absolute_error: 1.8609 - val_loss: 3.8618 - val_mean_squared_error: 3.8618 - val_mean_absolute_error: 1.4621\n",
      "Epoch 11/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 6.6788 - mean_squared_error: 6.6788 - mean_absolute_error: 1.9639 - val_loss: 16.3646 - val_mean_squared_error: 16.3646 - val_mean_absolute_error: 3.5325\n",
      "Epoch 12/200\n",
      "164/164 [==============================] - 5s 32ms/step - loss: 5.8847 - mean_squared_error: 5.8847 - mean_absolute_error: 1.8533 - val_loss: 4.9422 - val_mean_squared_error: 4.9422 - val_mean_absolute_error: 1.6293\n",
      "Epoch 13/200\n",
      "164/164 [==============================] - 6s 34ms/step - loss: 5.8018 - mean_squared_error: 5.8018 - mean_absolute_error: 1.8428 - val_loss: 4.0945 - val_mean_squared_error: 4.0945 - val_mean_absolute_error: 1.5832\n",
      "Epoch 14/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 5.6457 - mean_squared_error: 5.6457 - mean_absolute_error: 1.8255 - val_loss: 4.1660 - val_mean_squared_error: 4.1660 - val_mean_absolute_error: 1.5390\n",
      "Epoch 15/200\n",
      "164/164 [==============================] - 6s 38ms/step - loss: 5.7072 - mean_squared_error: 5.7072 - mean_absolute_error: 1.8316 - val_loss: 10.1655 - val_mean_squared_error: 10.1655 - val_mean_absolute_error: 2.6336\n",
      "Epoch 16/200\n",
      "164/164 [==============================] - 6s 34ms/step - loss: 5.3357 - mean_squared_error: 5.3357 - mean_absolute_error: 1.7623 - val_loss: 3.3096 - val_mean_squared_error: 3.3096 - val_mean_absolute_error: 1.3707\n",
      "Epoch 17/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 5.2198 - mean_squared_error: 5.2198 - mean_absolute_error: 1.7423 - val_loss: 3.7125 - val_mean_squared_error: 3.7125 - val_mean_absolute_error: 1.5246\n",
      "Epoch 18/200\n",
      "164/164 [==============================] - 6s 40ms/step - loss: 4.8432 - mean_squared_error: 4.8432 - mean_absolute_error: 1.6771 - val_loss: 5.5699 - val_mean_squared_error: 5.5699 - val_mean_absolute_error: 1.7916\n",
      "Epoch 19/200\n",
      "164/164 [==============================] - 5s 32ms/step - loss: 5.3444 - mean_squared_error: 5.3444 - mean_absolute_error: 1.7704 - val_loss: 3.4381 - val_mean_squared_error: 3.4381 - val_mean_absolute_error: 1.4239\n",
      "Epoch 20/200\n",
      "164/164 [==============================] - 5s 32ms/step - loss: 5.0555 - mean_squared_error: 5.0555 - mean_absolute_error: 1.7093 - val_loss: 4.8839 - val_mean_squared_error: 4.8839 - val_mean_absolute_error: 1.6538\n",
      "Epoch 21/200\n",
      "164/164 [==============================] - 6s 34ms/step - loss: 4.5353 - mean_squared_error: 4.5353 - mean_absolute_error: 1.6235 - val_loss: 6.3817 - val_mean_squared_error: 6.3817 - val_mean_absolute_error: 2.0654\n",
      "Epoch 22/200\n",
      "164/164 [==============================] - 6s 40ms/step - loss: 4.9246 - mean_squared_error: 4.9246 - mean_absolute_error: 1.6974 - val_loss: 3.3669 - val_mean_squared_error: 3.3669 - val_mean_absolute_error: 1.3691\n",
      "Epoch 23/200\n",
      "164/164 [==============================] - 6s 34ms/step - loss: 4.6261 - mean_squared_error: 4.6261 - mean_absolute_error: 1.6452 - val_loss: 4.3801 - val_mean_squared_error: 4.3801 - val_mean_absolute_error: 1.5356\n",
      "Epoch 24/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 4.6533 - mean_squared_error: 4.6533 - mean_absolute_error: 1.6350 - val_loss: 4.4800 - val_mean_squared_error: 4.4800 - val_mean_absolute_error: 1.5518\n",
      "Epoch 25/200\n",
      "164/164 [==============================] - 7s 40ms/step - loss: 4.2878 - mean_squared_error: 4.2878 - mean_absolute_error: 1.5801 - val_loss: 3.1547 - val_mean_squared_error: 3.1547 - val_mean_absolute_error: 1.3811\n",
      "Epoch 26/200\n",
      "164/164 [==============================] - 6s 35ms/step - loss: 4.9171 - mean_squared_error: 4.9171 - mean_absolute_error: 1.6914 - val_loss: 3.1473 - val_mean_squared_error: 3.1473 - val_mean_absolute_error: 1.3090\n",
      "Epoch 27/200\n",
      "164/164 [==============================] - 5s 32ms/step - loss: 4.0415 - mean_squared_error: 4.0415 - mean_absolute_error: 1.5348 - val_loss: 3.4598 - val_mean_squared_error: 3.4598 - val_mean_absolute_error: 1.3617\n",
      "Epoch 28/200\n",
      "164/164 [==============================] - 5s 31ms/step - loss: 4.2650 - mean_squared_error: 4.2650 - mean_absolute_error: 1.5731 - val_loss: 4.4737 - val_mean_squared_error: 4.4737 - val_mean_absolute_error: 1.5935\n",
      "Epoch 29/200\n",
      "164/164 [==============================] - 6s 39ms/step - loss: 4.0715 - mean_squared_error: 4.0715 - mean_absolute_error: 1.5351 - val_loss: 3.4626 - val_mean_squared_error: 3.4626 - val_mean_absolute_error: 1.4236\n",
      "Epoch 30/200\n",
      "164/164 [==============================] - 5s 31ms/step - loss: 4.2923 - mean_squared_error: 4.2923 - mean_absolute_error: 1.5791 - val_loss: 2.9205 - val_mean_squared_error: 2.9205 - val_mean_absolute_error: 1.2827\n",
      "Epoch 31/200\n",
      "164/164 [==============================] - 5s 31ms/step - loss: 4.4659 - mean_squared_error: 4.4659 - mean_absolute_error: 1.6127 - val_loss: 2.8746 - val_mean_squared_error: 2.8746 - val_mean_absolute_error: 1.2641\n",
      "Epoch 32/200\n",
      "164/164 [==============================] - 6s 35ms/step - loss: 3.8328 - mean_squared_error: 3.8328 - mean_absolute_error: 1.4867 - val_loss: 3.3182 - val_mean_squared_error: 3.3182 - val_mean_absolute_error: 1.3711\n",
      "Epoch 33/200\n",
      "164/164 [==============================] - 6s 35ms/step - loss: 3.9310 - mean_squared_error: 3.9310 - mean_absolute_error: 1.5079 - val_loss: 10.5427 - val_mean_squared_error: 10.5427 - val_mean_absolute_error: 2.5724\n",
      "Epoch 34/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 4.6900 - mean_squared_error: 4.6900 - mean_absolute_error: 1.6569 - val_loss: 2.7292 - val_mean_squared_error: 2.7292 - val_mean_absolute_error: 1.2171\n",
      "Epoch 35/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 3.6780 - mean_squared_error: 3.6780 - mean_absolute_error: 1.4525 - val_loss: 4.0533 - val_mean_squared_error: 4.0533 - val_mean_absolute_error: 1.4949\n",
      "Epoch 36/200\n",
      "164/164 [==============================] - 7s 40ms/step - loss: 4.0463 - mean_squared_error: 4.0463 - mean_absolute_error: 1.5284 - val_loss: 5.3819 - val_mean_squared_error: 5.3819 - val_mean_absolute_error: 1.7687\n",
      "Epoch 37/200\n",
      "164/164 [==============================] - 5s 32ms/step - loss: 4.4466 - mean_squared_error: 4.4466 - mean_absolute_error: 1.6105 - val_loss: 2.7933 - val_mean_squared_error: 2.7933 - val_mean_absolute_error: 1.2414\n",
      "Epoch 38/200\n",
      "164/164 [==============================] - 5s 32ms/step - loss: 4.1375 - mean_squared_error: 4.1375 - mean_absolute_error: 1.5514 - val_loss: 3.2047 - val_mean_squared_error: 3.2047 - val_mean_absolute_error: 1.3479\n",
      "Epoch 39/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 4.2739 - mean_squared_error: 4.2739 - mean_absolute_error: 1.5678 - val_loss: 2.9199 - val_mean_squared_error: 2.9199 - val_mean_absolute_error: 1.2726\n",
      "Epoch 40/200\n",
      "164/164 [==============================] - 7s 40ms/step - loss: 3.8063 - mean_squared_error: 3.8063 - mean_absolute_error: 1.4851 - val_loss: 2.5876 - val_mean_squared_error: 2.5876 - val_mean_absolute_error: 1.1822\n",
      "Epoch 41/200\n",
      "164/164 [==============================] - 5s 31ms/step - loss: 3.5403 - mean_squared_error: 3.5403 - mean_absolute_error: 1.4288 - val_loss: 5.6091 - val_mean_squared_error: 5.6091 - val_mean_absolute_error: 1.7943\n",
      "Epoch 42/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 3.9032 - mean_squared_error: 3.9032 - mean_absolute_error: 1.4979 - val_loss: 4.4927 - val_mean_squared_error: 4.4927 - val_mean_absolute_error: 1.6942\n",
      "Epoch 43/200\n",
      "164/164 [==============================] - 5s 32ms/step - loss: 4.1075 - mean_squared_error: 4.1075 - mean_absolute_error: 1.5363 - val_loss: 2.6201 - val_mean_squared_error: 2.6201 - val_mean_absolute_error: 1.2100\n",
      "Epoch 44/200\n",
      "164/164 [==============================] - 6s 36ms/step - loss: 3.7422 - mean_squared_error: 3.7422 - mean_absolute_error: 1.4680 - val_loss: 4.0389 - val_mean_squared_error: 4.0389 - val_mean_absolute_error: 1.4665\n",
      "Epoch 45/200\n",
      "164/164 [==============================] - 5s 31ms/step - loss: 3.8543 - mean_squared_error: 3.8543 - mean_absolute_error: 1.4988 - val_loss: 4.4555 - val_mean_squared_error: 4.4555 - val_mean_absolute_error: 1.5870\n",
      "Epoch 46/200\n",
      "164/164 [==============================] - 5s 32ms/step - loss: 3.6772 - mean_squared_error: 3.6772 - mean_absolute_error: 1.4561 - val_loss: 4.4119 - val_mean_squared_error: 4.4119 - val_mean_absolute_error: 1.5521\n",
      "Epoch 47/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 3.3546 - mean_squared_error: 3.3546 - mean_absolute_error: 1.3903 - val_loss: 5.2997 - val_mean_squared_error: 5.2997 - val_mean_absolute_error: 1.7164\n",
      "Epoch 48/200\n",
      "164/164 [==============================] - 6s 36ms/step - loss: 3.6195 - mean_squared_error: 3.6195 - mean_absolute_error: 1.4490 - val_loss: 3.4737 - val_mean_squared_error: 3.4737 - val_mean_absolute_error: 1.3460\n",
      "Epoch 49/200\n",
      "164/164 [==============================] - 6s 36ms/step - loss: 3.6415 - mean_squared_error: 3.6415 - mean_absolute_error: 1.4519 - val_loss: 2.2557 - val_mean_squared_error: 2.2557 - val_mean_absolute_error: 1.1143\n",
      "Epoch 50/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 3.4567 - mean_squared_error: 3.4567 - mean_absolute_error: 1.4115 - val_loss: 2.3929 - val_mean_squared_error: 2.3929 - val_mean_absolute_error: 1.1419\n",
      "Epoch 51/200\n",
      "164/164 [==============================] - 6s 35ms/step - loss: 3.4438 - mean_squared_error: 3.4438 - mean_absolute_error: 1.4106 - val_loss: 3.4282 - val_mean_squared_error: 3.4282 - val_mean_absolute_error: 1.3393\n",
      "Epoch 52/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 4.2237 - mean_squared_error: 4.2237 - mean_absolute_error: 1.5742 - val_loss: 10.0828 - val_mean_squared_error: 10.0828 - val_mean_absolute_error: 2.4894\n",
      "Epoch 53/200\n",
      "164/164 [==============================] - 7s 42ms/step - loss: 3.5669 - mean_squared_error: 3.5669 - mean_absolute_error: 1.4439 - val_loss: 3.7923 - val_mean_squared_error: 3.7923 - val_mean_absolute_error: 1.4632\n",
      "Epoch 54/200\n",
      "164/164 [==============================] - 5s 31ms/step - loss: 3.6759 - mean_squared_error: 3.6759 - mean_absolute_error: 1.4541 - val_loss: 4.2299 - val_mean_squared_error: 4.2299 - val_mean_absolute_error: 1.5138\n",
      "Epoch 55/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 3.5018 - mean_squared_error: 3.5018 - mean_absolute_error: 1.4235 - val_loss: 5.7622 - val_mean_squared_error: 5.7622 - val_mean_absolute_error: 1.8333\n",
      "Epoch 56/200\n",
      "164/164 [==============================] - 5s 31ms/step - loss: 3.7574 - mean_squared_error: 3.7574 - mean_absolute_error: 1.4714 - val_loss: 2.6580 - val_mean_squared_error: 2.6580 - val_mean_absolute_error: 1.2123\n",
      "Epoch 57/200\n",
      "164/164 [==============================] - 6s 37ms/step - loss: 3.4124 - mean_squared_error: 3.4124 - mean_absolute_error: 1.3954 - val_loss: 2.8069 - val_mean_squared_error: 2.8069 - val_mean_absolute_error: 1.2391\n",
      "Epoch 58/200\n",
      "164/164 [==============================] - 5s 31ms/step - loss: 3.2914 - mean_squared_error: 3.2914 - mean_absolute_error: 1.3729 - val_loss: 2.5702 - val_mean_squared_error: 2.5702 - val_mean_absolute_error: 1.2365\n",
      "Epoch 59/200\n",
      "164/164 [==============================] - 5s 33ms/step - loss: 3.3448 - mean_squared_error: 3.3448 - mean_absolute_error: 1.3879 - val_loss: 2.3932 - val_mean_squared_error: 2.3932 - val_mean_absolute_error: 1.1438\n"
     ]
    }
   ],
   "source": [
    "history = model.fit(data_generator.flow(X_train, y_train, batch_size=64),steps_per_epoch=len(X_train) // 64, \n",
    "                    epochs=200, validation_data=(X_val, y_val), verbose=1, callbacks=[early_stopping_cb, check_pointer])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "aa289adb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T11:05:08.930057Z",
     "iopub.status.busy": "2022-01-20T11:05:08.929250Z",
     "iopub.status.idle": "2022-01-20T11:05:15.212342Z",
     "shell.execute_reply": "2022-01-20T11:05:15.211058Z",
     "shell.execute_reply.started": "2022-01-11T12:14:37.292603Z"
    },
    "papermill": {
     "duration": 7.621327,
     "end_time": "2022-01-20T11:05:15.212541",
     "exception": false,
     "start_time": "2022-01-20T11:05:07.591214",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# resize test files\n",
    "test_dir = '../input/mlub2021-session8/test/test/test/'\n",
    "im_size = 64\n",
    "N = 500\n",
    "X_test = np.zeros((N, im_size,im_size))\n",
    "cont = 0\n",
    "\n",
    "for x in range(500):\n",
    "    im       = imageio.imread(test_dir + 'test_composite'+str(x).zfill(9) + '.png')/255.\n",
    "    small_im = transform.resize(im, (im_size,im_size), mode='symmetric', preserve_range=True)\n",
    "    X_test[cont, :,:] = small_im\n",
    "    cont += 1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "5ccff2fc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-20T11:05:18.043854Z",
     "iopub.status.busy": "2022-01-20T11:05:18.042826Z",
     "iopub.status.idle": "2022-01-20T11:05:21.507816Z",
     "shell.execute_reply": "2022-01-20T11:05:21.507353Z",
     "shell.execute_reply.started": "2022-01-11T12:14:40.233897Z"
    },
    "papermill": {
     "duration": 4.804447,
     "end_time": "2022-01-20T11:05:21.507945",
     "exception": false,
     "start_time": "2022-01-20T11:05:16.703498",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "X_test = X_test.reshape(500, 64, 64, 1)\n",
    "# predict and submit\n",
    "\n",
    "y_test = model.predict(X_test)\n",
    "y_test = [int(x[0]) for x in y_test]\n",
    "\n",
    "df_output = pd.DataFrame(y_test)\n",
    "df_output.index.name = 'index'\n",
    "df_output.columns = ['prediction']\n",
    "df_output.to_csv('output.csv')\n",
    "\n"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.12"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 746.89955,
   "end_time": "2022-01-20T11:05:25.805100",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2022-01-20T10:52:58.905550",
   "version": "2.3.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
